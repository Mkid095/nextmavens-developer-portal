{
  "project": "Project Lifecycle Management",
  "branchName": "flow/project-lifecycle",
  "description": "Project states: CREATED → ACTIVE → SUSPENDED → ARCHIVED → DELETED. Each state has defined behaviors. Keys work only in ACTIVE. Services disabled in SUSPENDED/ARCHIVED. Clear status indicators.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add Project Status Column",
      "description": "As a platform engineer, I want a status column on projects so that I can track project lifecycle.",
      "acceptanceCriteria": [
        "projects table updated with status column",
        "Status enum: created, active, suspended, archived, deleted",
        "Default value: created",
        "Migration script created",
        "Existing projects set to active",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": []
      },
      "priority": 1,
      "passes": true,
      "notes": "Completed: Migration 006_add_project_status_column.sql created with status column, enum constraint ('created', 'active', 'suspended', 'archived', 'deleted'), default value, index, and bug fix for UPDATE statement. Created src/lib/types/project.types.ts with ProjectStatus type, state behavior definitions, valid transitions, and helper functions. Updated CLI Project interface to use proper ProjectStatus type. Updated snapshot types to use lowercase values matching database schema. Typecheck passes."
    },
    {
      "id": "US-002",
      "title": "Define State Behaviors",
      "description": "As a platform engineer, I want behaviors defined per state so that the system responds correctly to project status.",
      "acceptanceCriteria": [
        "CREATED: Keys work, services active, data access full",
        "ACTIVE: Keys work, services active, data access full",
        "SUSPENDED: Keys don't work, services disabled, data read-only",
        "ARCHIVED: Keys don't work, services disabled, data read-only",
        "DELETED: Keys don't work, services disabled, data deleted (after grace)",
        "Documented in code",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": []
      },
      "priority": 1,
      "passes": true,
      "notes": "Completed: Created src/lib/types/project-lifecycle.types.ts with comprehensive state behavior definitions including ProjectStatus enum, StateBehavior interface, state behaviors map with all states (CREATED, ACTIVE, SUSPENDED, ARCHIVED, DELETED), valid transitions, and helper functions. Typecheck passes."
    },
    {
      "id": "US-003",
      "title": "Implement Activate Project",
      "description": "As a developer, I want to activate my project so that I can start using services.",
      "acceptanceCriteria": [
        "POST /api/projects/:id/activate endpoint",
        "Sets status to ACTIVE",
        "Enables all services",
        "Sends confirmation email",
        "Returns updated project",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 1,
      "passes": true,
      "notes": "Completed: Created POST /api/projects/[projectId]/activate endpoint with state transition validation, authentication, ownership check, audit logging, and correlation ID support. Email sending TODO added. Typecheck passes."
    },
    {
      "id": "US-004",
      "title": "Implement Suspend Project",
      "description": "As a platform operator, I want to suspend projects so that I can enforce limits or respond to abuse.",
      "acceptanceCriteria": [
        "POST /api/projects/:id/suspend endpoint",
        "Sets status to SUSPENDED",
        "Reason parameter required",
        "Disables services",
        "Keys return PROJECT_SUSPENDED error",
        "Notification sent to owner",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 1,
      "passes": true,
      "notes": "Completed: Created POST /api/projects/[projectId]/suspend endpoint with required reason parameter validation, state transition validation (only ACTIVE can be suspended), authentication, ownership check, audit logging, and correlation ID support. Returns suspension details including keys_disabled, services_disabled, data_access. Email notification TODO added. Typecheck passes."
    },
    {
      "id": "US-006",
      "title": "Implement Status Change API",
      "description": "As a developer, I want to change project status via API so that I can automate lifecycle management.",
      "acceptanceCriteria": [
        "PUT /api/projects/:id/status endpoint",
        "Request: new_status, reason",
        "Validates state transitions",
        "Logs status change to audit",
        "Returns updated project",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 1,
      "passes": true,
      "notes": "Completed: Created PUT /api/projects/[projectId]/status endpoint with comprehensive status change functionality. Accepts new_status and optional reason parameters. Validates state transitions using isValidTransition(), requires reason for SUSPENDED and DELETED transitions, implements ownership checks and authentication. Logs all status changes to audit with previous_status, new_status, and reason. Returns updated project with status_change details including behavior info (keys_enabled/disabled, services_enabled/disabled, data_access). Typecheck passes."
    },
    {
      "id": "US-007",
      "title": "Enforce Status Checks at Gateway",
      "description": "As a platform engineer, I want the gateway to check project status so that suspended projects can't make requests.",
      "acceptanceCriteria": [
        "Gateway checks project status on each request",
        "SUSPENDED returns PROJECT_SUSPENDED error",
        "ARCHIVED returns PROJECT_ARCHIVED error",
        "DELETED returns PROJECT_DELETED error",
        "Keys don't work for non-active states",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 1,
      "passes": true,
      "notes": "Completed: Implemented comprehensive gateway-level project status enforcement. Updated src/lib/middleware.ts to call checkProjectStatus() in authenticateRequest() for JWT authentication (Bearer tokens), ensuring project status is checked on ALL requests to the API gateway. Updated withAuth() middleware to handle PlatformError properly using toErrorNextResponse(). API key authentication already enforced via authenticateApiKey() in src/lib/auth.ts. Uses helper functions from project-lifecycle academic.types.ts (keysWorkForStatus, getErrorCodeForStatus). All error codes (PROJECT_SUSPENDED, PROJECT_ARCHIVED, PROJECT_DELETED) properly returned with appropriate 403 HTTP status codes. Typecheck passes."
    },
    {
      "id": "US-005",
      "title": "Implement Archive Project",
      "description": "As a developer, I want to archive inactive projects so that I don't pay for unused resources.",
      "acceptanceCriteria": [
        "POST /api/projects/:id/archive endpoint",
        "Sets status to ARCHIVED",
        "Disables services",
        "Keys stop working",
        "Data remains readable",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 2,
      "passes": true,
      "notes": "Completed: Created POST /api/projects/[projectId]/archive endpoint with state transition validation (ACTIVE or SUSPENDED → ARCHIVED), authentication, ownership check, audit logging, and correlation ID support. Sets status to ARCHIVED, disables services, keys stop working (return PROJECT_ARCHIVED error), and data remains readable (readonly access). Returns archival_details including keys_disabled, services_disabled, data_access. Typecheck passes."
    },
    {
      "id": "US-008",
      "title": "Create Status Badge UI",
      "description": "As a developer, I want to see project status in the UI so that I know the current state.",
      "acceptanceCriteria": [
        "Status badge on project detail page",
        "Status badge in project list",
        "Color-coded: Active (green), Suspended (red), Archived (yellow), Created (blue)",
        "Status explanation on hover",
        "Typecheck passes"
      ],
      "mavenSteps": [
        5,
        10
      ],
      "mcpTools": {
        "step5": [],
        "step10": []
      },
      "priority": 2,
      "passes": true,
      "notes": "Completed: Created ProjectStatusBadge component (src/components/ProjectStatusBadge.tsx) with color-coded badges for all project statuses: Active (green/emerald with CheckCircle icon), Suspended (red with XCircle icon), Archived (yellow with Archive icon), Created (blue with Clock icon), Deleted (gray with XCircle icon). Badge includes tooltip with status description on hover. Added status badge to project detail page header (next to environment badge) and to project list cards (in dashboard). All acceptance criteria met. Typecheck passes."
    },
    {
      "id": "US-009",
      "title": "Show Status Change History",
      "description": "As a developer, I want to see status change history so that I understand why my project was suspended.",
      "acceptanceCriteria": [
        "Status history section in project settings",
        "Shows previous status, new status, reason, timestamp",
        "Links to audit log entries",
        "Explains how to resolve suspension",
        "Typecheck passes"
      ],
      "mavenSteps": [
        5,
        10
      ],
      "mcpTools": {
        "step5": [],
        "step10": []
      },
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Implement Auto-Status Transitions",
      "description": "As a platform operator, I want automatic status transitions so that projects move through lifecycle without manual intervention.",
      "acceptanceCriteria": [
        "CREATED → ACTIVE after provisioning completes",
        "ACTIVE → SUSPENDED when hard cap exceeded",
        "SUSPENDED → ACTIVE after quota reset (if manual suspension)",
        "Background job handles transitions",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 2,
      "passes": false,
      "notes": ""
    }
  ],
  "relatedPRDs": [],
  "consolidatedMemory": "",
  "lessonsLearned": "",
  "memorialFile": "docs/memory/Project Lifecycle Management.md"
}