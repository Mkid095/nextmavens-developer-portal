{
  "project": "Standardized Error Format",
  "branchName": "flow/standardized-errors",
  "description": "Developers hate inconsistent errors. Define once, use everywhere. Standard error format with error codes, messages, documentation links, and retryable flags provides DX credibility and predictable, actionable error handling.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create Error Factory",
      "description": "As a platform engineer, I want an error factory so that all services return consistent error responses.",
      "acceptanceCriteria": [
        "Error factory created at src/lib/errors.ts",
        "Standard error shape defined",
        "createError(code, message, details) function",
        "Returns {error: {code, message, docs, retryable, project_id}}",
        "TypeScript types for error codes",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 1,
      "passes": true,
      "notes": "Completed: Created error factory at src/lib/errors.ts with ErrorCode enum, PlatformError class, createError() function, standard error response shape, and convenience functions for common errors. Typecheck passes."
    },
    {
      "id": "US-002",
      "title": "Define Error Codes",
      "description": "As a platform engineer, I want a comprehensive list of error codes so that errors are consistent across the platform.",
      "acceptanceCriteria": [
        "Error codes enum defined",
        "PROJECT_SUSPENDED - Project is suspended",
        "RATE_LIMITED - Too many requests",
        "QUOTA_EXCEEDED - Monthly quota exceeded",
        "KEY_INVALID - API key invalid or expired",
        "SERVICE_DISABLED - Service not enabled for project",
        "PERMISSION_DENIED - Insufficient permissions",
        "VALIDATION_ERROR - Request validation failed",
        "INTERNAL_ERROR - Unexpected server error",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": []
      },
      "priority": 1,
      "passes": true,
      "notes": "Completed: All required error codes defined in ErrorCode enum (PROJECT_SUSPENDED, RATE_LIMITED, QUOTA_EXCEEDED, KEY_INVALID, SERVICE_DISABLED, PERMISSION_DENIED, VALIDATION_ERROR, INTERNAL_ERROR). Typecheck passes."
    },
    {
      "id": "US-003",
      "title": "Add Retryable Flag",
      "description": "As a developer, I want to know if an error is retryable so that my client can handle it appropriately.",
      "acceptanceCriteria": [
        "Each error code has retryable flag",
        "Retryable: RATE_LIMITED (after delay), INTERNAL_ERROR",
        "Not retryable: PROJECT_SUSPENDED, QUOTA_EXCEEDED, KEY_INVALID, SERVICE_DISABLED, PERMISSION_DENIED, VALIDATION_ERROR",
        "Flag included in error response",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 1,
      "passes": true,
      "notes": "Completed: Retryable flags configured in ERROR_METADATA. Retryable: RATE_LIMITED, INTERNAL_ERROR. Not retryable: PROJECT_SUSPENDED, QUOTA_EXCEEDED, KEY_INVALID, SERVICE_DISABLED, PERMISSION_DENIED, VALIDATION_ERROR, AUTHENTICATION_ERROR, NOT_FOUND, CONFLICT, PROJECT_ARCHIVED, PROJECT_DELETED. Flag included in all error responses via PlatformError class. Typecheck passes."
    },
    {
      "id": "US-005",
      "title": "Update API Gateway Errors",
      "description": "As a developer, I want API gateway to use standard error format so that errors are consistent.",
      "acceptanceCriteria": [
        "API gateway updated to use error factory",
        "All errors return standard format",
        "Rate limit errors use RATE_LIMITED code",
        "Invalid key errors use KEY_INVALID code",
        "Service disabled errors use SERVICE_DISABLED code",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 1,
      "passes": true,
      "notes": "Completed: Updated API gateway to use standard error factory. Updated src/lib/middleware/schema-scope.ts to use toErrorNextResponse() with standard error codes. Updated src/lib/auth.ts and control-plane-api/src/lib/auth.ts to throw PlatformError with KEY_INVALID/AUTHENTICATION_ERROR codes. Updated control-plane-api/src/app/api/v1/projects/[id]/route.ts to use standard error format. Updated src/app/api/usage/check/route.ts to use standard error format with PROJECT_SUSPENDED, QUOTA_EXCEEDED, SERVICE_DISABLED codes. All errors now return standard format with code, message, docs, retryable, and timestamp. Typecheck passes."
    },
    {
      "id": "US-004",
      "title": "Add Documentation Links",
      "description": "As a developer, I want links to documentation in error responses so that I can understand and fix errors quickly.",
      "acceptanceCriteria": [
        "Each error code has documentation URL",
        "URL format: /docs/errors#{error_code}",
        "Link included in error response",
        "Documentation page created for each error",
        "Typecheck passes"
      ],
      "mavenSteps": [
        5,
        10
      ],
      "mcpTools": {
        "step5": [],
        "step10": []
      },
      "priority": 2,
      "passes": true,
      "notes": "Completed: Documentation URLs added to ERROR_METADATA for all error codes in format /docs/errors#{error_code}. Documentation page created at src/app/docs/errors/page.tsx with all 13 error codes documented including PROJECT_SUSPENDED, PROJECT_ARCHIVED, PROJECT_DELETED, RATE_LIMITED, QUOTA_EXCEEDED, KEY_INVALID, SERVICE_DISABLED, PERMISSION_DENIED, VALIDATION_ERROR, INTERNAL_ERROR, AUTHENTICATION_ERROR, NOT_FOUND, CONFLICT. Each error has id anchor for linking. Docs field included in all error responses via PlatformError.toResponse(). Typecheck passes."
    },
    {
      "id": "US-006",
      "title": "Update Auth Service Errors",
      "description": "As a developer, I want auth service to use standard error format so that authentication errors are consistent.",
      "acceptanceCriteria": [
        "Auth service updated to use error factory",
        "Authentication errors use standard format",
        "Permission errors use PERMISSION_DENIED code",
        "Validation errors use VALIDATION_ERROR code",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 2,
      "passes": true,
      "notes": "Completed: Updated src/app/api/auth/users/route.ts to use standardized error format. Authentication errors use authenticationError() with AUTHENTICATION_ERROR code. Validation errors use validationError() with VALIDATION_ERROR code. Permission errors use permissionDeniedError() with PERMISSION_DENIED code. Internal errors use internalError() with INTERNAL_ERROR code. All errors now return standard format with code, message, docs, retryable, and timestamp. Typecheck passes."
    },
    {
      "id": "US-007",
      "title": "Update GraphQL Service Errors",
      "description": "As a developer, I want GraphQL service to use standard error format so that GraphQL errors are consistent.",
      "acceptanceCriteria": [
        "GraphQL service updated to use error factory",
        "GraphQL errors use standard format",
        "Schema errors use VALIDATION_ERROR code",
        "Execution errors use INTERNAL_ERROR code",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 2,
      "passes": true,
      "notes": "Completed: GraphQL service updated to use standardized error format. Updated src/lib/graphql-service/snapshot-client.ts with: (1) GraphQLOperationResult interface with ErrorResponse field, (2) validateGraphQLOperation() returns standardized error responses, (3) graphQLSchemaError() helper uses VALIDATION_ERROR code, (4) graphQLExecutionError() helper uses INTERNAL_ERROR code, (5) Additional helper functions: graphQLIntrospectionError(), getGraphQLErrorResponse(), toGraphQLErrorNextResponse(). All GraphQL errors now return standard format with code, message, docs, retryable, and timestamp. Typecheck passes.",
    },
    {
      "id": "US-008",
      "title": "Update Realtime Service Errors",
      "description": "As a developer, I want realtime service to use standard error format so that WebSocket errors are consistent.",
      "acceptanceCriteria": [
        "Realtime service updated to use error factory",
        "Connection errors use standard format",
        "Rate limit errors use RATE_LIMITED code",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Update Storage Service Errors",
      "description": "As a developer, I want storage service to use standard error format so that storage errors are consistent.",
      "acceptanceCriteria": [
        "Storage service updated to use error factory",
        "Upload errors use standard format",
        "Quota errors use QUOTA_EXCEEDED code",
        "Typecheck passes"
      ],
      "mavenSteps": [
        1,
        2,
        7,
        10
      ],
      "mcpTools": {
        "step1": [],
        "step2": [],
        "step7": [],
        "step10": []
      },
      "priority": 2,
      "passes": true,
      "notes": "Completed: Updated src/app/api/storage/upload/route.ts to use standardized error format. Service disabled errors use serviceDisabledError() with SERVICE_DISABLED code. Validation errors use validationError() with VALIDATION_ERROR code. Quota errors (file size exceeded) use quotaExceededError() with QUOTA_EXCEEDED code. Permission errors use permissionDeniedError() with PERMISSION_DENIED code. Authentication errors use authenticationError() with AUTHENTICATION_ERROR code. All errors now return standard format with code, message, docs, retryable, and timestamp. Typecheck passes."
    },
    {
      "id": "US-010",
      "title": "Create Error Documentation Page",
      "description": "As a developer, I want comprehensive error documentation so that I can understand and resolve errors quickly.",
      "acceptanceCriteria": [
        "Error documentation page created at /docs/errors",
        "Each error code documented with:",
        "Searchable by error code",
        "Linked from error responses",
        "Typecheck passes"
      ],
      "mavenSteps": [
        5,
        10
      ],
      "mcpTools": {
        "step5": [],
        "step10": []
      },
      "priority": 2,
      "passes": true,
      "notes": "Completed: Error documentation page created at src/app/docs/errors/page.tsx. All 13 error codes documented with code, title, HTTP status, retryable flag, description, common causes, and solutions. Page includes error response format documentation. Each error has id anchor for hash linking (#error_code). Page is linked from error responses via docs field. Typecheck passes."
    }
  ],
  "relatedPRDs": [],
  "consolidatedMemory": "",
  "lessonsLearned": "",
  "memorialFile": "docs/memory/Standardized Error Format.md"
}